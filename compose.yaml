x-common-config:
  &common-config
  network_mode: host
  ipc: host
  restart: always
  environment:
    - FASTRTPS_DEFAULT_PROFILES_FILE=/shm-only.xml

services:

  rosbot:
    image: husarion/rosbot:humble-0.11.0-20231211
    <<: *common-config
    # privileged: ${PRIVILEGED:-false}
    devices:
      - ${SERIAL_PORT:?err}
      # - /dev/bus/usb/ # FTDI
    command: >
      ros2 launch rosbot_bringup combined.launch.py 
        mecanum:=${MECANUM:-False}
        serial_port:=$SERIAL_PORT 
        serial_baudrate:=576000

  astra:
    image: husarion/astra:humble
    <<: *common-config
    devices:
      - /dev/bus/usb/
    volumes:
      - ./params/astra.yaml:/ros2_ws/install/astra_camera/share/astra_camera/params/astra_mini_params.yaml
    command: ros2 launch astra_camera astra_mini.launch.py

  # image_compressor:
  #   # image: husarion/image-transport:humble
  #   image: husarion/image-tools:humble-nightly
  #   <<: *common-config
  #   command: >
  #     ros2 run image_transport republish raw ${CODEC:-theora}
  #       --ros-args
  #       --remap in:=/camera/color/image_raw
  #       --remap out/${CODEC:-theora}:=/camera/color/image_raw/${CODEC:-theora}
        
  ros2router:
    image: husarnet/ros2router:1.4.0
    network_mode: host
    ipc: host
    restart: always
    volumes:
      - ./filter.yaml:/filter.yaml
